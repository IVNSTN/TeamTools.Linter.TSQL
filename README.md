
# TeamTools Linter TSQL

Библиотека для статического анализа кода на языке T-SQL.

## Правила

В библиотеке реализованы около 400 правил, которые подразделяются на группы:

- явные ошибки
- потенциальные уязвимости
- неоднозначность, избыточность
- вопросы производительности
- хардкод
- соблюдение шаблонов именования
- форматирование
- сомнительный код или CODE SMELL
- и другие

В документации также можно ориентироваться через группировку некоторых правил, ориентированных на конкретный функционал БД:
индексы, триггеры, курсоры, ин-мемори разработка.

[Документация к правилам](./TeamTools.TSQL.Linter/Resources/Docs)

## Установка

Библиотеку нужно подключить в конфигурационном файле консольной утилиты [TeamTools.Linter.CommandLine](https://github.com/IVNSTN/TeamTools.Linter.CommandLine) в качестве одного из плагинов. Данная библиотека уже входит в состав поставки CLI-утилиты и подключена по умолчанию. Чтобы начать пользоваться реализованными правилами скачайте актуальную версию CLI-утилиты из репозитория по приведенной в начале этого абзаца ссылке.

## Настройка

Плагин настраивается путем редайтирования [файла конфигурации](./TeamTools.TSQL.Linter/DefaultConfig.json). Таких конфигурационных файлов можно создать несколько, например, один для линтинга с учетом требований к именованию и форматированию, другой - только для поиска явных и потенциальных проблем. Правила можно отключить или включить обратно, 
повысить или понизить серьёзность нарушения любого правила, установив нужное значение напротив идентификатора правила в разделе "rules" конфигурационного файла:

|||
|-|-|
| **off** | правило отключено
| **hint** | нарушение правила учитывается как info-сообщение
| **warning** | нарушение правила означает потенциально значимое предупреждение, но не явную ошибку
| **error** | нарушение правила означает явную ошибку времени компиляции или времени выполнения

Однако не стоит завышать значимость некоторых правил и превращать в ошибку (уровень значимости error) то, что является нарушением действующих соглашений
или предложением по оптимизации, чтобы таким образом переводить статус CI-пайплайна в состояние неуспеха. Вместо повышения severity конкретного правила
установите более подходящий _уровень чувствительности_ консольной утилиты, управляющей работой этого и других плагинов. Задайте параметр минимального severity на уровне warning и нарушение любого правила с таким уровнем важности будет означать неуспешный билд. Подробнее смотрите в документации к утилите.

Требуемый **compatibility level** для корректного парсинга исходного кода нужно установить в разделе options конфигурационного файла.

## Интеграция

Библиотека предназначена для подключения в качестве плагина к утилите для запуска линтинга в консоли - **TeamTools.TSQL.Linter.CommandLine**

Консольник умеет выдавать результат в формате, понятном сервису **SonarQube** ([формат отчета](https://docs.sonarsource.com/sonarqube-server/9.9/analyzing-source-code/importing-external-issues/generic-issue-import-format/) для версий до 10.0), поэтому утилиту вполне можно применять не только локально на компьютере программиста, но и встраивать в CI-пайплайн. По работе с консольной утилитой смотрите описание в её [репозитории](https://github.com/IVNSTN/TeamTools.Linter.CommandLine).

## Совместимость

Парсинг кода выполняется библиотекой [ScriptDom](https://github.com/microsoft/SqlScriptDOM). Правила поддерживают уровни совместимости MS SQL SERVER **от 100 до 170** включительно.

В других уровнях совместимости часть правил может исправно работать, однако это специально не тестировалось и корректное поведение не гарантируется.


## Благодарности

Вначале библиотека разрабатывалась как плагин к линтеру [tsqllint](https://github.com/tsqllint/tsqllint) (опубликованному под лицензией MIT), но со временем функционал перерос возможности этого инструмента и был оформлен в отдельный продукт со своим раннером и протоколом работы с плагинами. Тем не менее, выражаем огромную благодарность авторам проекта tsqllint.
