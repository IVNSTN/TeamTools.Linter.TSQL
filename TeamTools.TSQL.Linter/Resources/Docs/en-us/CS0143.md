

# RETURN value not redefined explicitly after CATCH

|||
|-|-|
| Id | **CS0143**
| Mnemo | PROC_RETURN_REQUIRED_AFTER_CATCH
| Severity | ⚠ Warning
| Category | [CodeSmell](./Category_CodeSmell.md)
| Source code | [ReturnValueFromProcIfTryCatchUsedRule.cs](../../../Rules/CodeSmell/ReturnValueFromProcIfTryCatchUsedRule.cs)

## Cause

This rule is triggered if there is no explicit `RETURN` with a return value after the `TRY...CATCH` block.
<p id="descr">Add a RETURN with a return value after the TRY-CATCH block.</p>

## Examples

Bad

```sql
CREATE PROCEDURE dbo.foo
AS
BEGIN
    BEGIN TRY
        SELECT 1;

        RETURN 0;
    END TRY
    BEGIN CATCH
        SELECT ERROR_MESSAGE();
    END CATCH;
END;
```

Good

```sql
ALTER PROCEDURE dbo.foo
AS
BEGIN
    BEGIN TRY
        SELECT 1;

        RETURN 0;
    END TRY
    BEGIN CATCH
        -- return in the catch
        RETURN 1;
    END CATCH;
END;
GO

ALTER PROCEDURE dbo.foo
AS
BEGIN
    BEGIN TRY
        SELECT 1;

        RETURN 0;
    END TRY
    BEGIN CATCH
        SELECT ERROR_MESSAGE();
    END CATCH;

    -- return after catch
    RETURN 0;
END;
```

## Tips

💡 The default return code is zero, but if an error is handled by a `TRY...CATCH` block, the implicit return code value may change. If there was an error and `CATCH` suppressed it but did not explicitly `RETURN 0`, the caller may receive a non-zero return code and perceive it as an abnormal termination. After `CATCH`, always make an explicit `RETURN <value>` with an explicitly specified error or success code.

💡 Doesn't trigger if `CATCH` has `THROW` or `RAISERROR`.

💡 Doesn't trigger if there is `RETURN` after the `BEGIN CATCH` statement. It doesn't matter where exactly, as long as it's further in the code.

## Links

[TRY...CATCH](https://learn.microsoft.com/en-us/sql/t-sql/language-elements/try-catch-transact-sql?view=sql-server-ver16)
