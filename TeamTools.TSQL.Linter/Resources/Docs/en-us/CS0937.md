

# Implicit string truncation

|||
|-|-|
| Id | **CS0937**
| Mnemo | IMPLICIT_STRING_TRUNCATION
| Severity | ℹ Hint
| Category | [CodeSmell](./Category_CodeSmell.md)
| Source code | [ImplicitTruncationRule.cs](../../../Rules/CodeSmell/ImplicitTruncationRule.cs)

## Cause

The rule is triggered if an implicit string truncation occurs in the assignment or call of a string function.
<p id="descr">Specify the correct size of the string variable.</p>

## Examples

Bad

```sql
DECLARE @str1 varchar(5) = '123456789'
...
DECLARE @str2 varchar(max)
SET @str2 = replicate('1', 10000)
...
DECLARE @I VARCHAR(1)
SELECT ISNULL(@I, 'NULL')
```

Good

```sql
DECLARE @str1 varchar(5) = '12345'
...
DECLARE @str2 varchar(max)
SET @str2 = replicate(CAST('1' AS VARCHAR(max)), 10000)
...
DECLARE @I VARCHAR(1)
SELECT ISNULL(CAST(@I AS VARCHAR(4)), 'NULL')
SELECT COALESCE(@I, 'NULL')
```

## Tips

💡 If the literal is larger than the size that a string variable can store, then it will be implicitly truncated, which may lead to data loss.

💡 ISNULL truncates the size of the second parameter to the size of the first, so ISNULL(<1 character variable>, 'NULL') will return 'N', not 'NULL' if the variable is really NULL. You need to explicitly convert to the size of the second parameter. The IIF and COALESCE functions work differently, they do not truncate the value.

## Links

[Function - ISNULL](https://learn.microsoft.com/en-us/sql/t-sql/functions/isnull-transact-sql?view=sql-server-ver16)

[Function - IIF](https://learn.microsoft.com/en-us/sql/t-sql/functions/logical-functions-iif-transact-sql?view=sql-server-ver16)

[Function - COALESCE](https://learn.microsoft.com/en-us/sql/t-sql/language-elements/coalesce-transact-sql?view=sql-server-ver16)
