

# Query with recursive CTE should have MAXRECURSION limit

|||
|-|-|
| Id | **CS0942**
| Mnemo | CTE_MAX_RECURSION
| Severity | ℹ Hint
| Category | [CodeSmell](./Category_CodeSmell.md)
| Source code | [RecursiveCteMaxRecursionRule.cs](../../../Rules/CodeSmell/RecursiveCteMaxRecursionRule.cs)

## Cause

The rule is triggered if there is no limit on the maximum number of recursions in the recursive query.
<p id="descr">Limit the number of recursion levels allowed.</p>

## Examples

Bad

```sql
;WITH CTE_recursive AS
(
...
)
SELECT C.Path, C.Level
FROM CTE AS C;
```

Good

```sql
;WITH CTE_recursive AS
(
...
)
SELECT C.Path, C.Level
FROM CTE AS C
OPTION (MAXRECURSION 10);
```

## Tips

💡 MAXRECURSION in SQL Server is a parameter that sets a limit on the number of recursion levels allowed for a particular instruction. This function is used to prevent an infinite loop that may occur as a result of an incorrectly implemented recursive CTE expression.

💡 By default, the MAXRECURSION value is set to 100. However, if you plan to work with a limited number of tree levels, it is recommended to set a more specific value, less than 100.

💡 For trees with unlimited or very deep nesting, recursion may not be the optimal solution. Instead, it is worth considering the HIERARCHYID system database type or its custom equivalent, where the full delimited path is stored.

## Links

[Recursive common table expressions](https://learn.microsoft.com/en-us/sql/t-sql/queries/with-common-table-expression-transact-sql?view=sql-server-ver16#d-use-a-recursive-common-table-expression-to-display-multiple-levels-of-recursion)

[HIERARCHYID data type method reference](https://learn.microsoft.com/en-us/sql/t-sql/data-types/hierarchyid-data-type-method-reference?view=sql-server-ver16)
