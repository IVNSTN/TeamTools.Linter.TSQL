

# Loop based on @@FETCHSTATUS has no FETCH statement inside

|||
|-|-|
| Id | **CS0954**
| Mnemo | LOOP_FETCHSTATUS_MISSING_FETCH
| Severity | ⚠ Warning
| Category | [CodeSmell](./Category_CodeSmell.md), [Cursors](./Group_Cursors.md)
| Source code | [FetchingLoopMissingFetchRule.cs](../../../Rules/CodeSmell/FetchingLoopMissingFetchRule.cs)

## Cause

The rule is triggered if the WHILE loop condition checks the status of reading from the cursor, but the FETCH cursor statement is missing from the loop itself.
<p id="descr">Add the FETCH statement to the loop.</p>

## Examples

Bad

```sql
WHILE @@FETCH_STATUS = 0
BEGIN
    FROM my_cursor
    INTO @id;
...
```

Good

```sql
WHILE @@FETCH_STATUS = 0
BEGIN
    FETCH NEXT
    FROM my_cursor
    INTO @id;
...
```

## Tips

💡 It may be worth reviewing the loop continuation condition and removing the @@FETCHSTATUS check.

## Links

[Use WHILE in a cursor](https://learn.microsoft.com/en-us/sql/t-sql/language-elements/while-transact-sql?view=sql-server-ver16#b-use-while-in-a-cursor)
