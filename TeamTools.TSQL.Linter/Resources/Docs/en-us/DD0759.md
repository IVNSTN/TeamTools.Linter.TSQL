

# For partitioned tables, it is recommended to use the LOCK_ESCALATION = AUTO option

|||
|-|-|
| Id | **DD0759**
| Mnemo | PARTITIONED_TABLE_LOCK_ESCALATION
| Severity | ⚠ Warning
| Category | [DatabaseDesign](./Category_DatabaseDesign.md)
| Source code | [BadLockEscalationForPartitionedTableRule.cs](../../../Rules/DatabaseDesign/BadLockEscalationForPartitionedTableRule.cs)

## Cause

This rule is triggered when LOCK_ESCALATION different from AUTO is used for partitioned table.
<p id="descr">Use LOCK_ESCALATION = AUTO.</p>

## Examples

Bad

```sql
CREATE TABLE dbo.foo
(
    id      INT  NOT NULL,
    date    DATE NOT NULL
) ON DatePartitioning(date);
GO

ALTER TABLE dbo.foo SET (LOCK_ESCALATION = DISABLE);
GO
```

Good

```sql
CREATE TABLE dbo.foo
(
    id      INT  NOT NULL,
    date    DATE NOT NULL
) ON DatePartitioning(date);
GO

ALTER TABLE dbo.foo SET (LOCK_ESCALATION = AUTO);
GO
```

## Tips

💡 Partitioned tables allow you to work with each partition separately, which reduces contention for row and page locks, as well as the system overhead of maintaining multiple fine-grained locks. When implemented correctly, this approach also reduces the likelihood of deadlocks. However, if lock escalation is required, the DBMS will escalate to the table level by default, and the benefit of partitioning is lost. However, in some cases, escalating locks to the table level can reduce the likelihood of deadlock. In general, for partitioned tables, it is recommended to use the LOCK_ESCALATION = AUTO option.

## Links

[LOCK_ESCALATION](https://learn.microsoft.com/en-us/sql/t-sql/statements/alter-table-transact-sql?view=sql-server-ver16#set--lock_escalation---auto--table--disable--)
