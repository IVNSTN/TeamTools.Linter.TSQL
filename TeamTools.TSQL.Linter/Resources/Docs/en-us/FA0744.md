

# WHERE CURRENT OF is used for read only cursor

|||
|-|-|
| Id | **FA0744**
| Mnemo | CURSOR_NOT_MODIFIABLE
| Severity | ⚠ Warning
| Category | [Failure](./Category_Failure.md), [Cursors](./Group_Cursors.md)
| Source code | [UpdatingReadonlyCursorRule.cs](../../../Rules/Failure/UpdatingReadonlyCursorRule.cs)

## Cause

This rule is triggered when WHERE CURRENT OF is used in code for read only cursor.
<p id="descr">Remove WHERE CURRENT OF or change cursor options.</p>

## Examples

Bad

```sql
DECLARE
    @id           INT
    , @calc_value DECIMAL
    , @my_cursor  CURSOR;

SET @my_cursor = CURSOR FORWARD_ONLY FOR
    SELECT id, calc_value FROM dbo.foo
    FOR READ ONLY;

OPEN @my_cursor;

WHILE 1 = 1
BEGIN
    FETCH NEXT FROM @my_cursor
    INTO
        @id
        , @calc_value;

    IF @@FETCH_STATUS <> 0
        BREAK;

    UPDATE dbo.foo
    SET calc_value = 123
    WHERE CURRENT OF @my_cursor;
END;

CLOSE @my_cursor;
DEALLOCATE @my_cursor;
```

Good

```sql
DECLARE
    @id           INT
    , @calc_value DECIMAL
    , @my_cursor  CURSOR;

SET @my_cursor = CURSOR FORWARD_ONLY FOR
    SELECT id, calc_value FROM dbo.foo
    FOR READ ONLY;

OPEN @my_cursor;

WHILE 1 = 1
BEGIN
    FETCH NEXT FROM @my_cursor
    INTO
        @id
        , @calc_value;

    IF @@FETCH_STATUS <> 0
        BREAK;

    UPDATE dbo.foo
    SET calc_value = 123
    WHERE id = @id;
END;

CLOSE @my_cursor;
DEALLOCATE @my_cursor;
```
