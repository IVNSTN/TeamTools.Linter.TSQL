

# Invalid aggregate argument

|||
|-|-|
| Id | **FA0939**
| Mnemo | INVALID_AGGREGATE_ARG
| Severity | ⚠ Warning
| Category | [Failure](./Category_Failure.md)
| Source code | [InvalidAggregateArgumentRule.cs](../../../Rules/Failure/InvalidAggregateArgumentRule.cs)

## Cause

The rule is triggered if the NULL literal or subquery is passed to aggregate function.
<p id="descr">Delete NULL or subquery from aggregate function.</p>

## Examples

Bad

```sql
SELECT SUM(AVG(sales_amount))
FROM dbo.sales;

SELECT COUNT(NULL) AS cnt
FROM dbo.sales_data pr
```

Good

```sql
WITH avg_sales AS
(
  SELECT AVG(sales_amount) AS average_sales
  FROM dbo.sales
)
SELECT SUM(average_sales)
FROM avg_sales;

SELECT COUNT(1) AS cnt
FROM dbo.sales_data pr
```

## Tips

💡 In SQL Server certain aggregate functions such as COUNT, MIN, MAX and functions such as DATEADD require a data type. NULL, on its own, does not have one so it leads to the error: "Operand data type NULL is invalid for count operator."

💡 In SQL queries when attempting to use an aggregate function like SUM(), AVG(), COUNT(), etc., on a result that already contains an aggregate function or a subquery. This error typically occurs: "Cannot perform an aggregate function on an expression containing an aggregate or a subquery."
