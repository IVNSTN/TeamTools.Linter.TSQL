
# Column is not included in GROUP BY or aggregate function

|||
|-|-|
| Id | **FA0949**
| Mnemo | COLUMN_NOT_IN_GROUP_BY
| Severity | ⚠ Warning
| Category | [Failure](./Category_Failure.md)
| Source code | [ColumnNotIncludedInGroupByRule.cs](../../../Rules/Failure/ColumnNotIncludedInGroupByRule.cs)

## Cause

The rule is triggered if a column participates in a selection where there is a grouping, but does not participate in GROUP BY definition and aggregation is not performed on it.
<p id="descr">Specify the non-aggregated query columns in GROUP BY.</p>

## Examples

Bad

```sql
SELECT SUM(Amount) total_amount, col1, col2
FROM dbo.Orders
GROUP BY col1
```

Good

```sql
SELECT SUM(Amount) total_amount, col1, col2
FROM dbo.Orders
GROUP BY col1, col2
```

## Tips

💡 The rule does not trigger to expressions with calculations and transformations if the `GROUP BY` contains the same expression in its entirety. But only if it is written in the same way, i.e. there are the same aliases, the same number of brackets, and the operators are in the same order. It can handle the difference in whitespaces, but not yet the rest.

💡 `GROUP BY` cannot work on aliases of calculated columns from `SELECT`, as `ORDER BY` does. To reduce the amount of identical code, you can move the calculations to `CROSS` or `OUTER APPLY` without `FROM` and then in `GROUP BY` and `SELECT` use the column names from this `APPLY`.

## Links

[Aggregate Functions](https://learn.microsoft.com/en-us/sql/t-sql/functions/aggregate-functions-transact-sql?view=sql-server-ver16)

[SELECT — GROUP BY](https://learn.microsoft.com/en-us/sql/t-sql/queries/select-group-by-transact-sql?view=sql-server-ver16)
