

# Cursor defined for modification of readonly column

|||
|-|-|
| Id | **FA0981**
| Mnemo | CURSOR_MODIFIES_READONLY_COL
| Severity | ⚠ Warning
| Category | [Failure](./Category_Failure.md)
| Source code | [CursorForUpdateReadonlyColumnRule.cs](../../../Rules/Failure/CursorForUpdateReadonlyColumnRule.cs)

## Cause

The rule is triggered if an attempt is detected to change the value of a read-only column using the cursor.
<p id="descr">Specify non read-only column.</p>

## Examples

Bad

```sql
CREATE TABLE dbo.Product
(
    ProductId     INT          IDENTITY(1, 1) NOT NULL
    , ProductName VARCHAR(100) NOT NULL
    , ProductType VARCHAR(100) NOT NULL
    , Quantity    SMALLINT     NULL
    , Price       MONEY        NULL
    , Summa       AS (Quantity * Price) PERSISTED
);
GO

DECLARE update_cursor CURSOR FOR
    SELECT ProductId, Summa FROM dbo.Product WHERE ProductType = 'example';

OPEN update_cursor;

FETCH FROM update_cursor;

WHILE @@FETCH_STATUS = 0
BEGIN
    UPDATE dbo.Product SET Summa = 100 WHERE CURRENT OF update_cursor;

    FETCH NEXT FROM update_cursor;
END;
```

Good

```sql
CREATE TABLE dbo.Product
(
    ProductId     INT          IDENTITY(1, 1) NOT NULL
    , ProductName VARCHAR(100) NOT NULL
    , ProductType VARCHAR(100) NOT NULL
    , Quantity    SMALLINT     NULL
    , Price       MONEY        NULL
    , Summa       MONEY        NULL
);
GO

DECLARE update_cursor CURSOR FOR
    SELECT ProductId, Price, Quantity FROM dbo.Product WHERE ProductType = 'example';

OPEN update_cursor;

FETCH FROM update_cursor;

WHILE @@FETCH_STATUS = 0
BEGIN
    UPDATE dbo.Product SET Summa = (Price * Quantity) WHERE CURRENT OF update_cursor;

    FETCH NEXT FROM update_cursor;
END;
```

## Tips

💡 A computed column can't be the target of an INSERT or UPDATE statement.

## Links

[Specify computed columns in a table](https://learn.microsoft.com/en-us/sql/relational-databases/tables/specify-computed-columns-in-a-table?view=sql-server-ver16)
