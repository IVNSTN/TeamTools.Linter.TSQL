

# Login-based code flow

|||
|-|-|
| Id | **HD0157**
| Mnemo | LOGIN_BASED_FLOW
| Severity | ⚠ Warning
| Category | [Hardcode](./Category_Hardcode.md)
| Source code | [LoginBasedCodeFlowRule.cs](../../../Rules/Hardcode/LoginBasedCodeFlowRule.cs)

## Cause

This rule is triggered if login-based code flow is detected.
<p id="descr">Remove code flow based on the current login.</p>

## Examples

Bad

```sql
IF (@a = 'A') AND (ORIGINAL_LOGIN() = 'me')
    SELECT 1

UPDATE t SET
    foo = bar
FROM tbl AS t
WHERE t.name <> SUSER_SNAME()
    AND t.name <> SYSTEM_USER

WHILE CURRENT_USER != 'me' AND SESSION_USER != 'me'
    DELETE dbo.clients
```

Good

```sql
SELECT SYSTEM_USER, SUSER_SNAME(), CURRENT_USER

UPDATE t SET
    caller = SESSION_USER
FROM tbl AS t
WHERE caller IS NULL

WHILE @ORIGINAL_LOGIN = @SESSION_USER
    DELETE dbo.clients
```

## Tips

💡Access is determined by grants or by internal access system. There must be data somewhere that controls privileges, not hardcode. Algorithms are also should use this data for flow control.
