
# Clock-based code flow

|||
|-|-|
| Id | **MA0174**
| Mnemo | CLOCK_BASED_CODE_FLOW
| Severity | ℹ Hint
| Category | [Maintainablity](./Category_Maintainablity.md)
| Source code | [ClockBasedCodeFlowRule.cs](../../../Rules/Maintainability/ClockBasedCodeFlowRule.cs)

## Cause

This rule is triggered if a clock-based code flow detected.
<p id="descr">Remove the current date or time functions from the condition.</p>

## Examples

Bad

```sql
IF SYSDATETIME() > '19990101'
    SELECT GETDATE(), SYSDATETIME(), @today

UPDATE t
SET
    dtupdate = SYSDATETIME()
FROM tbl AS t
WHERE close_date < GETDATE();
```

Good

```sql
SELECT GETDATE(), SYSDATETIME(), @today;

UPDATE t
SET
    dtupdate = SYSDATETIME()
FROM tbl AS t
WHERE close_date IS NULL;
```

## Tips

💡 If the code has to check, for example, at whether it is trading time, take this knowledge out into a scalar function with the calculation of both the time and the final attribute inside. At least such a function can be mocked for tests, and there will be no reason to wait for the appropriate time to start the test.

💡 It is highly desirable to move away from `IF-ELSE` to `STATE/STRATEGY`, for example, based on data. Save the working time in a "calendar table" (schedule table) and estimate algorithm needed based on the result of the SELECT, and not from the hardcode based at actual dates and time.
