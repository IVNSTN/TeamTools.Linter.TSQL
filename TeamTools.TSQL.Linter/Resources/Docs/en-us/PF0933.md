

# CTE used multiple times

|||
|-|-|
| Id | **PF0933**
| Mnemo | CTE_MULTIPLE_CALLS
| Severity | ℹ Hint
| Category | [Performance](./Category_Performance.md)
| Source code | [MultipleJoinsToCteRule.cs](../../../Rules/Performance/MultipleJoinsToCteRule.cs)

## Cause

<p id="descr">Multiple references to a CTE will result in its repeated execution, which can negatively impact performance.</p>

## Examples

Bad

```sql
;WITH cte AS (SELECT 1 AS id)
UPDATE tb
SET id = ct.id + 1
FROM dbo.foo AS tb
INNER JOIN cte AS ct -- here
    ON ct.id = b.id
LEFT JOIN dbo.bar AS bb
    ON bb.title = tb.title
OUTER APPLY (SELECT TOP (1) id FROM cte WHERE cte.id > bb.id ORDER BY id) AS cc -- here
WHERE NOT EXISTS (SELECT 1 FROM cte AS ccc WHERE ccc < ct.id); -- here
```

Good

```sql
;WITH cte AS (SELECT 1 AS id)
UPDATE ct SET
    id = ct.id + 1
FROM dbo.foo AS tf
LEFT JOIN cte AS ct
    ON ct.id = tf.id
```

## Tips

💡 If there is an excessive load, transferring data to a temporary table and replacing the CTE with this temporary table could be beneficial. However, be aware of the potential volume of data that could be inserted into it.
