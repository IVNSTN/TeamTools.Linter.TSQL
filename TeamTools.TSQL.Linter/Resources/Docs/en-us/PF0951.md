

# Unexpected sorting of function output

|||
|-|-|
| Id | **PF0951**
| Mnemo | FN_SORTED_OUTPUT
| Severity | ⚠ Warning
| Category | [Performance](./Category_Performance.md)
| Source code | [SortedOutputFromFunctionRule.cs](../../../Rules/Performance/SortedOutputFromFunctionRule.cs)

## Cause

<p id="descr">There is no need to sort the result set of functions, as they are embedded in other queries where the final sorting will be applied. Sorting within functions is either redundant or may lead to an unreliable solution.</p>

## Examples

Bad

```sql
CREATE FUNCTION dbo.my_fn ()
RETURNS TABLE
AS
    RETURN
    SELECT TOP (50) id, title FROM dbo.foo ORDER BY id;
```

Good

```sql
CREATE FUNCTION dbo.my_fn ()
RETURNS TABLE
AS
    RETURN
    SELECT TOP (1) id, title FROM dbo.foo ORDER BY id;
```

## Tips

💡 In application interfaces, users often have the ability to change the sorting, making it unnecessary to handle sorting within database functions. Even if sorting is fixed and cannot be modified by users, this is an application-level decision. Shifting this logic and responsibility to the database is not recommended. It is more efficient to let the application manage the sorting.

💡 The rule does not trigger if the following are used in sorting:
* TOP (1) - the function may be designed to compute the single most appropriate value.
* OFFSET FETCH - the function may be used for pagination or similar purposes.
