

# Непредсказуемый результат выражения TOP

|||
|-|-|
| Id | **AM0114**
| Мнемо | ORDER_BY_TOP
| Серьёзность | ⚠ Предупреждение
| Категория | [Неоднозначность](./Категория_Неоднозначность.md)
| Исходный код | [OrderedTopRule.cs](../../../Rules/Ambiguity/OrderedTopRule.cs)

## Причина

Правило срабатывает, если запрос содержит инструкцию TOP и не имеет ORDER BY.
<p id="descr">Укажите сортировку или удалите выражение TOP.</p>

## Примеры

Некорректно

```sql
SELECT TOP(10) id FROM dbo.employee
```

Корректно

```sql
SELECT TOP(10) id FROM dbo.employee ORDER BY salary
```

## Подсказки

💡 ORDER BY - это единственный способ прогнозировать, какие строки затрагивает TOP.

💡 Обратите внимание, возможно TOP и вовсе лишний.
SET @var = (SELECT id FROM dbo.branches WHERE name = 'главный')
Такие запросы часто пишутся специально чтобы отловить ситуации неоднозначного возврата результата. Наличие TOP тут разрушит все смыслы.

## Ссылки

[Defensive Database Programming Book](https://www.red-gate.com/library/defensive-database-programming)
