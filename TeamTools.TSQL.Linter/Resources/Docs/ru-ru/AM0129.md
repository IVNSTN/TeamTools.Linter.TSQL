

# Неоднозначность секционирования индекса для секционированной таблицы

|||
|-|-|
| Id | **AM0129**
| Мнемо | AMBIGUOUS_INDEX_PARTITIONING
| Серьёзность | ⚠ Предупреждение
| Категория | [Неоднозначность](./Категория_Неоднозначность.md), [Индексы](./Группа_Индексы.md)
| Исходный код | [PartitionedTableIndexOptionsRule.cs](../../../Rules/Ambiguity/PartitionedTableIndexOptionsRule.cs)

## Причина

<p id="descr">Правило срабатывает, если не указана файловая группа, в которую должен быть помещен индекс для секционированной таблицы.</p>

## Примеры

Некорректно

```sql
-- секционированная таблица dbo.log
CREATE NONCLUSTERED INDEX ix_dbo_log_id ON dbo.log (id); -- секционированный индекс
CREATE NONCLUSTERED INDEX ix_dbo_log_log_level ON dbo.log (log_level); -- секционированный индекс
CREATE NONCLUSTERED INDEX ix_dbo_log_inserted_by ON dbo.log (inserted_by) ON [DEFAULT]; -- секционированный индекс
```

Корректно

```sql
-- секционированная таблица dbo.log
CREATE NONCLUSTERED INDEX ix_dbo_log_id ON dbo.log (id) ON log_partitions(inserted_at); -- секционированный индекс
CREATE NONCLUSTERED INDEX ix_dbo_log_log_level ON dbo.log (log_level) ON [PRIMARY]; -- не секционированный индекс
```

## Подсказки

💡 Если создается индекс для секционированной таблицы и не указывается файловая группа, в которую должен быть помещен индекс, индекс секционируется так же, как и базовая таблица. Дело в том, что по умолчанию индексы помещаются в те же файловые группы, что и их базовые таблицы, а в случае секционированной таблицы — в схему секционирования, использующую те же самые столбцы секционирования. Когда индекс использует ту же схему и столбец секционирования, что и таблица, индекс выравнивается с таблицей.

💡 "default" не указывает файловую группу по умолчанию для базы данных в контексте CREATE INDEX, а указывает, что индекс должен быть размещен в той же файловой группе, в которой находится таблица или представление. В случае с инструкцией CREATE TABLE поведение иное: значение "default" указывает расположение таблицы в файловой группе по умолчанию для базы данных.

## Ссылки

[CREATE INDEX. Секционированные индексы.](https://learn.microsoft.com/en-us/sql/t-sql/statements/create-index-transact-sql?view=sql-server-ver16#partitioned-indexes)
