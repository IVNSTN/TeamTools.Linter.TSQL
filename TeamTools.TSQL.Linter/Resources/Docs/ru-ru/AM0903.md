

# Множественный возврат в одну и ту же переменную

|||
|-|-|
| Id | **AM0903**
| Мнемо | SAME_VAR_MULTIPLE_OUTPUT
| Серьёзность | ⚠ Предупреждение
| Категория | [Неоднозначность](./Категория_Неоднозначность.md)
| Исходный код | [MultipleOutputToSameVariableRule.cs](../../../Rules/Ambiguity/MultipleOutputToSameVariableRule.cs)

## Причина

<p id="descr">Правило срабатывает, если осуществляется возврат из нескольких параметров хранимой процедуры в одну и ту же переменную.</p>

## Примеры

Некорректно

```sql
EXEC @var = my_proc
    @var = @var OUTPUT,
    @dt  = @var OUTPUT;

EXEC my_proc
    @var = @var OUTPUT,
    @dt  = @var OUTPUT;

exec sp_executesql N'dummy', N'dummy',
    @var = @var OUTPUT,
    @dt  = @var OUTPUT;
```

Корректно

```sql
EXEC my_proc

EXEC my_proc @foo, 'bar', @dar OUTPUT

EXEC @res = my_proc
    @p   = @v,
    @var = @foo OUTPUT,
    @dt  = @bar OUTPUT;

EXEC @res = sp_executesql N'dummy', N'dummy',
    @p   = 'p',
    @var = @foo OUTPUT,
    @dt  = @bar OUTPUT;
```

## Подсказки

💡 Возврат из нескольких параметров хранимой процедуры в одну и ту же переменную не имеет смысла и скорее всего является логической ошибкой. \
Пример ошибки:

```sql
EXEC @var = dbo.my_proc
    @param_a = 'a',
    @param_b = @var OUTPUT,
    @param_c = @var OUTPUT;
```

Здесь в одну и ту же переменную @var трижды кладется выхлоп из вызова хранимой процедуры: RETURN значение и OUT из параметров param_b и param_c. На что рассчитывает автор такого вызова непонятно.

💡 Если вам не нужны значения из OUTPUT параметров, но они обязательны для указания в вызове хранимой процедуры, то вместо фиктивного перекладывания в мусорную переменную просто передайте NULL или другой скаляр без указания опции OUTPUT. Если не нужно значение RETURN, возвращаемое хранимой процедурой, то просто не складывайте его никуда.
