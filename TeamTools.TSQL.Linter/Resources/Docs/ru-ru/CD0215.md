

# Вычисляемый столбец находится перед персистентным столбцом

|||
|-|-|
| Id | **CD0215**
| Мнемо | COMPUTED_COLS_ORDER
| Серьёзность | ⚠ Предупреждение
| Категория | [НепрерывнаяПоставка](./Категория_НепрерывнаяПоставка.md)
| Исходный код | [ComputedColumnsOrderRule.cs](../../../Rules/ContinuousDeployment/ComputedColumnsOrderRule.cs)

## Причина

Правило срабатывает, если в определении таблицы вычисляемый столбец находится перед обычными.
<p id="descr">Переместите вычисляемые столбцы в конец.</p>

## Примеры

Некорректно

```sql
CREATE TABLE a
(
    b   INT     NOT NULL DEFAULT 1
    , bar AS CASE WHEN Id  = 1 OR Id = 2 OR Id = 3 THEN 10 ELSE 100 END
    , c CHAR(1) NULL DEFAULT 'd'
);
GO
```

Корректно

```sql
CREATE TABLE a
(
    b   INT     NOT NULL DEFAULT 1
    , c CHAR(1) NULL DEFAULT 'd'
    , bar AS CASE WHEN Id  = 1 OR Id = 2 OR Id = 3 THEN 10 ELSE 100 END
);
GO
```

## Подсказки

💡 Вычисляемые столбцы невозможно изменить, можно только удалить и добавить заново. При этом изменится порядок столбцов, и если столбец был в середине, то после добавления окажется в конце.

DacFx выполняет изменения так, чтобы сохранить порядок столбцов. Для этого он перезаливает таблицу, пересоздавая все столбцы в том же порядке, что были. Это тяжелая операция, которую нужно избегать.

Если все вычисляемые столбцы находятся в конце таблицы, изменение первого пройдёт легко. Таблица не будет перезаполняться данными. Будут удалены и заново созданы только те вычисляемые столбцы, которые идут после изменяемого. В скрипте будет один простой оператор `DROP` и более сложный `ADD` со столбцами и выражениями для их вычисления.
