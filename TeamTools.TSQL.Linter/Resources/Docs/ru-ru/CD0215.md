

# Вычисляемый столбец находится перед персистентным столбцом

|||
|-|-|
| Id | **CD0215**
| Мнемо | COMPUTED_COLS_ORDER
| Серьёзность | ⚠ Предупреждение
| Категория | [НепрерывнаяПоставка](./Категория_НепрерывнаяПоставка.md)
| Исходный код | [ComputedColumnsOrderRule.cs](../../../Rules/ContinuousDeployment/ComputedColumnsOrderRule.cs)

## Причина

Срабатывает из-за нахождения вычисляемых столбцов перед обычными.
<p id="descr">Переместите вычисляемые столбцы в конец.</p>

## Примеры

Некорректно

```sql
CREATE TABLE a
(
    b   INT     NOT NULL DEFAULT 1
    , bar AS CASE WHEN Id  = 1 OR Id = 2 OR Id = 3 THEN 10 ELSE 100 END
    , c CHAR(1) NULL DEFAULT 'd'
    
);
GO
```

Корректно

```sql
CREATE TABLE a
(
    b   INT     NOT NULL DEFAULT 1
    , c CHAR(1) NULL DEFAULT 'd'
    , bar AS CASE WHEN Id  = 1 OR Id = 2 OR Id = 3 THEN 10 ELSE 100 END
);
GO
```

## Подсказки

💡 Вычисляемые колонки невозможно изменить, можно только удалить и добавить заново. При этом изменится порядок колонок, и если колонка была в середине, то после добавления окажется в конце.

DacFx выполняет изменения так, чтобы сохранить порядок колонок. Для этого он перезаливает таблицу, пересоздавая все колонки в том же порядке, что были. Это тяжелая операция, которую нужно избегать.

Если все вычисляемые колонки находятся в конце таблицы, изменение первой пройдёт легко. Таблица не будет перезаполняться данными. Будут удалены и заново созданы только те вычисляемые колонки, которые идут после изменяемой. В скрипте будет один простой оператор DROP и более сложный ADD с колонками и выражениями для их вычисления.
