

# Проверка @@ROWCOUNT не имеет смысла

|||
|-|-|
| Id | **CS0126**
| Мнемо | BAD_ROWCOUNT_CHECK
| Серьёзность | ⚠ Предупреждение
| Категория | [СомнительноеКодирование](./Категория_СомнительноеКодирование.md)
| Исходный код | [RowCountAfterNoCountRule.cs](../../../Rules/CodeSmell/RowCountAfterNoCountRule.cs)

## Причина

Правило срабатывает, если обнаружено использование `@@ROWCOUNT` после инструкций или выражений, которые делают такую проверку `@@ROWCOUNT` бессмысленной.
<p id="descr">Проверьте корректность условия @@ROWCOUNT.</p>

## Примеры

Некорректно

```sql
DECLARE @a INT;

SET NOCOUNT ON;

SET @a = 1; -- always sets ROWCOUNT to 1

SELECT @@ROWCOUNT;

SELECT a, b, c FROM dbo.foo WHERE a = @a;

SET ANSI_WARNINGS ON; -- always sets ROWCOUNT to 0

SELECT @@ROWCOUNT;
```

Корректно

```sql
SET NOCOUNT, ANSI_WARNINGS ON;

DECLARE @a INT = 1;

SELECT a, b, c FROM dbo.foo WHERE a = @a;

SELECT @@ROWCOUNT;
```

## Подсказки

💡 Правило проверяет, что между сменой опций `SET NOCOUNT ON` и обращением к `@@ROWCOUNT` есть выражения, которые способны сменить этот счетчик, иначе обращения к `@@ROWCOUNT` не имеют смысла.

💡 Присвоение значения переменной по факту сдвигает `@@ROWCOUNT`, однако после такого проверять `@@ROWCOUNT` несколько бессмысленно, поэтому правило срабатывает и на такие выражения.
