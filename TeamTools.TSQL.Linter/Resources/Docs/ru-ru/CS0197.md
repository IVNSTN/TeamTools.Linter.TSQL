

# Ошибка в порядке команд управления курсором

|||
|-|-|
| Id | **CS0197**
| Мнемо | CURSOR_COMMAND_ORDER
| Серьёзность | ⚠ Предупреждение
| Категория | [СомнительноеКодирование](./Категория_СомнительноеКодирование.md), [Курсоры](./Группа_Курсоры.md)
| Исходный код | [CursorCommandOrderRule.cs](../../../Rules/CodeSmell/CursorCommandOrderRule.cs)

## Причина

Правило срабатывает, если допущена ошибка в порядке команд управления курсором.
<p id="descr">Исправьте порядок команд управления курсором.</p>

## Примеры

Некорректно

```sql
DECLARE cr CURSOR READ_ONLY FOR
    SELECT 1;
OPEN cr;
FETCH NEXT FROM cr INTO @id;

WHILE @@FETCH_STATUS = 0
BEGIN
    FETCH NEXT FROM cr INTO @id;
END;

CLOSE cr;
```

Корректно

```sql
DECLARE cr CURSOR READ_ONLY FOR
    SELECT 1;
OPEN cr;
FETCH NEXT FROM cr INTO @id;

WHILE @@FETCH_STATUS = 0
BEGIN
    FETCH NEXT FROM cr INTO @id;
END;

CLOSE cr;
DEALLOCATE cr;
```

## Подсказки

💡 Ожидаемый порядок команд:

- DECLARE
- OPEN
- FETCH
- CLOSE
- DEALLOCATE
