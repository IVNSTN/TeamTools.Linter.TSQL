

# Операции, основанные на наборе, предпочтительнее операций с курсорами для обновления

|||
|-|-|
| Id | **CS0745**
| Мнемо | CURSOR_FOR_UPDATE
| Серьёзность | ⚠ Предупреждение
| Категория | [СомнительноеКодирование](./Категория_СомнительноеКодирование.md)
| Исходный код | [CursorForUpdateRule.cs](../../../Rules/CodeSmell/CursorForUpdateRule.cs)

## Причина

Правило срабатывает если присутствует курсор для обновления CURSOR FOR UPDATE OF.
<p id="descr">Замените курсор на UPDATE запрос.</p>

## Примеры

Некорректно

```sql
...
DECLARE EMP_CURSOR CURSOR FOR
SELECT id, ins_date FROM dbo.my_table
FOR UPDATE OF ins_date
...
```

Корректно

```sql
UPDATE MT
SET MT.ins_date = GETDATE()
FROM dbo.my_table AS MT
WHERE ...
```

## Подсказки

💡 Если возможно переписать CURSOR FOR UPDATE OF в инструкцию UPDATE или MERGE, то лучше так и сделать. Желательно не применять курсоры для работы с таблицами базы данных.

## Ссылки

[UPDATE (Transact-SQL)](https://learn.microsoft.com/ru-ru/sql/t-sql/queries/update-transact-sql?view=sql-server-ver16)

[MERGE (Transact-SQL)](https://learn.microsoft.com/ru-ru/sql/t-sql/statements/merge-transact-sql?view=sql-server-ver16)

[Курсор FOR UPDATE OF](https://learn.microsoft.com/ru-ru/sql/t-sql/language-elements/declare-cursor-transact-sql?view=sql-server-ver16#for-update--of-column_name--n--)
