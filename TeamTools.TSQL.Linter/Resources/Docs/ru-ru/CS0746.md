

# Неожиданное управление форматом даты

|||
|-|-|
| Id | **CS0746**
| Мнемо | DATE_FORMAT_CONTROL
| Серьёзность | ⚠ Предупреждение
| Категория | [СомнительноеКодирование](./Категория_СомнительноеКодирование.md)
| Исходный код | [DateFormatControlRule.cs](../../../Rules/CodeSmell/DateFormatControlRule.cs)

## Причина

Правило срабатывает, если в коде встречается управление опциями DATEFIRST, DATEFORMAT.
<p id="descr">Удалите управление опциями DATEFIRST, DATEFORMAT.</p>

## Примеры

Некорректно

```sql
SET DATEFORMAT DMY;
DECLARE @datevar DATETIME ;
SELECT @datevar = '2024-12-25'
```

Корректно

```sql
SELECT CONVERT(VARCHAR(20), GETDATE(), 103)  AS current_date
```

## Подсказки

💡 Подобное управление опциями может быть уместно и даже необходимо в пользовательских отчетах и подобном коде, но точно не в большинстве хранимых процедур и триггеров. Зависимые от предпочтений пользователя или, наоборот, гарантированно независимые от настроек среды исполнения отчеты лучше вынести в отдельную схему и добавить её в исключения линтера.

## Ссылки

[SET DATEFIRST (Transact-SQL)](https://learn.microsoft.com/ru-ru/sql/t-sql/statements/set-datefirst-transact-sql?view=sql-server-ver16)

[SET DATEFORMAT (Transact-SQL)](https://learn.microsoft.com/ru-ru/sql/t-sql/statements/set-dateformat-transact-sql?view=sql-server-ver16)

[Функция CONVERT, стили даты и времени](https://learn.microsoft.com/ru-ru/sql/t-sql/functions/cast-and-convert-transact-sql?view=sql-server-ver16#date-and-time-styles)
