
# Соответствие возвращаемого и ожидаемого типов данных

|||
|-|-|
| Id | **CS0785**
| Мнемо | RETURN_VALUE_TYPE_MISMATCH
| Серьёзность | ⚠ Предупреждение
| Категория | [СомнительноеКодирование](./Категория_СомнительноеКодирование.md)
| Исходный код | [ReturnValueTypeMismatchRule.cs](../../../Rules/CodeSmell/ReturnValueTypeMismatchRule.cs)

## Причина

Правило срабатывает, если в процедуре возвращается значение, не являющееся типом `INT`, или если в скалярной функции возвращаемое значение не соответствует объявленному типу.
<p id="descr">Приведите возвращаемое значение к правильному типу.</p>

## Примеры

Некорректно

```sql
CREATE PROC dbo.one
AS
BEGIN
    -- only INT is supported
    RETURN 'adsf';
END
```

Корректно

```sql
CREATE PROC dbo.zero_return
AS
BEGIN
    RETURN 0;
END
```

## Подсказки

💡 Из процедуры можно вернуть только `INT`. Из скалярной пользовательской функции нужно возвращать тот тип, который указан в её объявлении. Если же в выражении `RETURN` возвращаемое значение имеет вообще не тот тип, то будет либо ошибка времени выполнения, либо потеря данных/точности, либо написано что-то небрежное в расчёте на неявное приведение типа.

💡 На потенциальные усечения `INT`->`SMALLINT`, несоответствие длины строк правило не реагирует, конкретные значения не анализирует. В некоторых случаях допущения о взаимозаменяемости типов оставлены, чтобы снизить потенциальные ложные срабатывания. В основном это замечание касается целых и строковых типов.
