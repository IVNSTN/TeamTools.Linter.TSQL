
# Потеря символов юникода при присваивании значения

|||
|-|-|
| Id | **CS0791**
| Мнемо | NATIONAL_SYMBOL_LOSS
| Серьёзность | ℹ Подсказка
| Категория | [СомнительноеКодирование](./Категория_СомнительноеКодирование.md)
| Исходный код | [NationalSymbolLossRule.cs](../../../Rules/CodeSmell/NationalSymbolLossRule.cs)

## Причина

Правило срабатывает, если значение типа `NVARCHAR`, `NCHAR` или `SYSNAME` присваивается переменной или возвращается из функции с типом `VARCHAR` или `CHAR`, что может привести к потере юникодных символов.
<p id="descr">Измените тип переменной или возвращаемого значения на поддерживающий юникод.</p>

## Примеры

Некорректно

```sql
DECLARE @bar CHAR(5) = N'☀️';     -- 1

SET @bar = CONCAT(N'☀️', '');     -- 2
```

Корректно

```sql
DECLARE @bar NCHAR(5) = N'☀️';

SET @bar = CONCAT(N'☁️', ' ');
```

## Подсказки

💡 Если юникода в выражении/значении-источнике быть не может - не вычисляйте и не объявляйте его как юникод.

💡 Часть срабатываний будут всегда "условно ложно-положительными" - это перекладывание `ERROR_MESSAGE()` в переменные типа `VARCHAR`. Чтобы там де-факто возник юникод нужно постараться самим же разработчикам данной БД, поэтому неявное преобразование скорее не несёт угрозы потери информации. Но всё же пренебрежительное отношение к исходным типам строк однажды может и "стрельнуть". Например, если в сообщении об ошибке нужно будет указать допускающие юникод значение, введённое пользователем в каком-то поле графического интерфейса или переданное через параметр.
