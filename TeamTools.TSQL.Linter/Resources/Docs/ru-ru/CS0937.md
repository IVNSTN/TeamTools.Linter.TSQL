

# Неявное усечение строки

|||
|-|-|
| Id | **CS0937**
| Мнемо | IMPLICIT_STRING_TRUNCATION
| Серьёзность | ℹ Подсказка
| Категория | [СомнительноеКодирование](./Категория_СомнительноеКодирование.md)
| Исходный код | [ImplicitTruncationRule.cs](../../../Rules/CodeSmell/ImplicitTruncationRule.cs)

## Причина

Правило срабатывает, если происходит неявное усечение строки в присвоении или вызове строковой функции.
<p id="descr">Укажите правильный размер строковой переменной.</p>

## Примеры

Некорректно

```sql
DECLARE @str1 varchar(5) = '123456789'
...
DECLARE @str2 varchar(max)
SET @str2 = replicate('1', 10000)
...
DECLARE @I VARCHAR(1)
SELECT ISNULL(@I, 'NULL')
```

Корректно

```sql
DECLARE @str1 varchar(5) = '12345'
...
DECLARE @str2 varchar(max)
SET @str2 = replicate(CAST('1' AS VARCHAR(max)), 10000)
...
DECLARE @I VARCHAR(1)
SELECT ISNULL(CAST(@I AS VARCHAR(4)), 'NULL')
SELECT COALESCE(@I, 'NULL')
```


## Подсказки

💡 Если литерал больше размера, который может принять строковая переменная, то он будет неявно усечен, что может привести к потере данных.

💡 ISNULL усекает размер второго параметра до размера первого, поэтому ISNULL(<переменная размером 1 символ>, 'NULL') вернет 'N', а не 'NULL' если в переменной действительно NULL. Нужно явно приводить к размеру второго параметра. Функции IIF и COALESCE работают иначе, не усекают значение.

## Ссылки

[Функция ISNULL](https://learn.microsoft.com/ru-ru/sql/t-sql/functions/isnull-transact-sql?view=sql-server-ver16)

[Функция IIF](https://learn.microsoft.com/ru-ru/sql/t-sql/functions/logical-functions-iif-transact-sql?view=sql-server-ver16)

[Функция COALESCE](https://learn.microsoft.com/ru-ru/sql/t-sql/language-elements/coalesce-transact-sql?view=sql-server-ver16)
