

# Предикат [NOT] EXISTS предпочтительнее, чем предикат IN

|||
|-|-|
| Id | **CS0938**
| Мнемо | EXISTS_INSTEAD_OF_IN
| Серьёзность | ⚠ Предупреждение
| Категория | [СомнительноеКодирование](./Категория_СомнительноеКодирование.md)
| Исходный код | [InSelectToExistsRule.cs](../../../Rules/CodeSmell/InSelectToExistsRule.cs)

## Причина

Правило срабатывает, если для проверки строк применяется предикат IN вместо EXISTS.
<p id="descr">Замените предикат IN на EXISTS.</p>

## Примеры

Некорректно

```sql
...
WHERE object_id IN (SELECT Id FROM dbo.objects WHERE ...)
```

Корректно

```sql
...
WHERE EXISTS(SELECT Id FROM dbo.objects WHERE Id = object_id AND ...)
```

## Подсказки

💡 Целесообразность EXISTS или IN зависит от контекста запроса, поэтому итоговый план выполнения запроса лучше проверить.

💡 NOT EXISTS не зависит от наличия NULL в результате подзапроса. Он возвращает TRUE, когда из подзапроса не возвращаются строки или возвращается ноль строк. NOT IN, в свою очередь, не может сравнивать NULL значения. Если любая строка подзапроса возвращает NULL, оператор NOT IN оценит всё выражение как FALSE или NULL и не вернёт записи.

## Ссылки

[Предложение NOT](https://learn.microsoft.com/ru-ru/sql/t-sql/language-elements/not-transact-sql?view=sql-server-ver16)

[Предложение IN](https://learn.microsoft.com/ru-ru/sql/t-sql/language-elements/in-transact-sql?view=sql-server-ver16)

[Предложение EXISTS](https://learn.microsoft.com/ru-ru/sql/t-sql/language-elements/exists-transact-sql?view=sql-server-ver16)

[Как работает NOT IN с NULL значениями](https://learn.microsoft.com/en-us/answers/questions/657695/how-works-not-in-with-nulls-value)
