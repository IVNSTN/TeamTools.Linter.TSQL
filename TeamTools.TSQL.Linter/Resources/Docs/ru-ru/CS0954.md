

# Цикл, основанный на @@FETCHSTATUS, не содержит инструкции FETCH внутри

|||
|-|-|
| Id | **CS0954**
| Мнемо | LOOP_FETCHSTATUS_MISSING_FETCH
| Серьёзность | ⚠ Предупреждение
| Категория | [СомнительноеКодирование](./Категория_СомнительноеКодирование.md), [Курсоры](./Группа_Курсоры.md)
| Исходный код | [FetchingLoopMissingFetchRule.cs](../../../Rules/CodeSmell/FetchingLoopMissingFetchRule.cs)

## Причина

Правило срабатывает, если в условии цикла WHILE проверяется статус чтения из курсора, но в самом цикле отсутствует команда чтения из курсора FETCH.
<p id="descr">Добавьте в цикл команду FETCH.</p>

## Примеры

Некорректно

```sql
WHILE @@FETCH_STATUS = 0
BEGIN
    FROM my_cursor
    INTO @id;
...
```

Корректно

```sql
WHILE @@FETCH_STATUS = 0
BEGIN
    FETCH NEXT
    FROM my_cursor
    INTO @id;
...
```

## Подсказки

💡 Возможно, стоит пересмотреть условие продолжения цикла и убрать оттуда проверку @@FETCHSTATUS.

## Ссылки

[Использование WHILE в курсоре](https://learn.microsoft.com/ru-ru/sql/t-sql/language-elements/while-transact-sql?view=sql-server-ver16#b-use-while-in-a-cursor)
