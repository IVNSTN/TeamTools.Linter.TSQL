

# Ненадежная проверка типа данных

|||
|-|-|
| Id | **CS0960**
| Мнемо | UNRELIABLE_TYPE_CHECK
| Серьёзность | ⚠ Предупреждение
| Категория | [СомнительноеКодирование](./Категория_СомнительноеКодирование.md)
| Исходный код | [UnreliableTypeCheckRule.cs](../../../Rules/CodeSmell/UnreliableTypeCheckRule.cs)

## Причина

Правило срабатывает, если проверки содержимого строк на принадлежность числовому типу или дате реализованы через функции ISNUMERIC и ISDATE.
<p id="descr">Для проверки типа данных используйте TRY_CONVERT.</p>

## Примеры

Некорректно

```sql
SELECT ISNUMERIC('$100,00'), ISDATE('04/15/2008');
```

Корректно

```sql
SELECT TRY_CAST('$100,00' AS DECIMAL(5, 2)), TRY_CONVERT(DATETIME, '04/15/2008', 101);
...
```

## Подсказки

💡 **ISNUMERIC** допускает символ доллара и запятую в качестве десятичного разделителя, однако преобразовать такой текст в DECIMAL средствами конвертации SQL Server нельзя.

💡 **ISDATE** опирается на текущую выбранную в сеансе или батче культуру, язык и формат даты (настройки **SET LANGUAGE**, **SET DATEFORMAT**). Чтобы проверка работала корректно, нужно либо постоянно устанавливать определенную культуру, либо предполагать, что правильное значение будет установлено всегда, что нельзя гарантировать. Форматов даты много, позиция месяца и дня в дате может отличаться. Лучше использовать функции **CONVERT**/**TRY_CONVERT**, указав конкретный формат.

💡 Используйте функции **PARSE, CAST** и **CONVERT**, если в случае некорректного формата значения необходимо вызывать исключение. Если же ошибка не критична, и результатом преобразования должен быть **NULL**, то применяйте **TRY_PARSE, TRY_CAST** и **TRY_CONVERT**.

## Ссылки

[Функции CAST и CONVERT](https://learn.microsoft.com/ru-ru/sql/t-sql/functions/cast-and-convert-transact-sql?view=sql-server-ver16)

[Функции PARSE](https://learn.microsoft.com/ru-ru/sql/t-sql/functions/parse-transact-sql?view=sql-server-ver16)

[Функция TRY_CONVERT](https://learn.microsoft.com/ru-ru/sql/t-sql/functions/try-convert-transact-sql?view=sql-server-ver16)

[Функция TRY_CAST](https://learn.microsoft.com/ru-ru/sql/t-sql/functions/try-cast-transact-sql?view=sql-server-ver16)

[Функция TRY_PARSE](https://learn.microsoft.com/ru-ru/sql/t-sql/functions/try-parse-transact-sql?view=sql-server-ver16)

[Функция ISNUMERIC](https://learn.microsoft.com/ru-ru/sql/t-sql/functions/isnumeric-transact-sql?view=sql-server-ver16)

[Функция ISDATE](https://learn.microsoft.com/ru-ru/sql/t-sql/functions/isdate-transact-sql?view=sql-server-ver16)
