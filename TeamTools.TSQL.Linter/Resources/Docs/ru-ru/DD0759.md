

# Для секционированных таблиц рекомендовано использовать LOCK_ESCALATION = AUTO

|||
|-|-|
| Id | **DD0759**
| Мнемо | PARTITIONED_TABLE_LOCK_ESCALATION
| Серьёзность | ⚠ Предупреждение
| Категория | [ДизайнБазДанных](./Категория_ДизайнБазДанных.md)
| Исходный код | [BadLockEscalationForPartitionedTableRule.cs](../../../Rules/DatabaseDesign/BadLockEscalationForPartitionedTableRule.cs)

## Причина

Правило срабатывает, если для секционированной таблицы установлен LOCK_ESCALATION отличный от AUTO.
<p id="descr">Используйте LOCK_ESCALATION = AUTO.</p>

## Примеры

Некорректно

```sql
CREATE TABLE dbo.foo
(
    id      INT  NOT NULL,
    date    DATE NOT NULL
) ON DatePartitioning(date);
GO

ALTER TABLE dbo.foo SET (LOCK_ESCALATION = DISABLE);
GO
```

Корректно

```sql
CREATE TABLE dbo.foo
(
    id      INT  NOT NULL,
    date    DATE NOT NULL
) ON DatePartitioning(date);
GO

ALTER TABLE dbo.foo SET (LOCK_ESCALATION = AUTO);
GO
```

## Подсказки

💡 Секционированные таблицы позволяют работать с каждой секцией отдельно, что снижает конкуренцию за блокировку строк и страниц, а также системные накладные расходы на обслуживание множества мелкогранулярных блокировок. При правильной реализации такой подход также уменьшает вероятность возникновения взаимоблокировок. Однако, если требуется эскалация блокировки, то СУБД по умолчанию выполнит эскалацию до уровня таблицы, и преимущество секционирования будет утрачено. Тем не менее, в некоторых случаях эскалация блокировки до уровня таблицы может снизить вероятность возникновения взаимоблокировок. В общем случае, для секционированных таблиц, рекомендуется рассмотреть возможность использования опции LOCK_ESCALATION = AUTO.

## Ссылки

[ALTER TABLE (Transact-SQL)](https://learn.microsoft.com/ru-ru/sql/t-sql/statements/alter-table-transact-sql?view=sql-server-ver16#set--lock_escalation---auto--table--disable--)
