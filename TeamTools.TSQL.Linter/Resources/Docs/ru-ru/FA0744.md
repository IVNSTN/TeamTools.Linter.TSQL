

# Использование WHERE CURRENT OF для курсора не предусматривающего обновления

|||
|-|-|
| Id | **FA0744**
| Мнемо | CURSOR_NOT_MODIFIABLE
| Серьёзность | ⚠ Предупреждение
| Категория | [Сбой](./Категория_Сбой.md), [Курсоры](./Группа_Курсоры.md)
| Исходный код | [UpdatingReadonlyCursorRule.cs](../../../Rules/Failure/UpdatingReadonlyCursorRule.cs)

## Причина

Правило срабатывает, если в коде используется WHERE CURRENT OF для курсора не предусматривающего обновления.
<p id="descr">Удалите WHERE CURRENT OF, или измените параметры курсора.</p>

## Примеры

Некорректно

```sql
DECLARE
    @id           INT
    , @calc_value DECIMAL
    , @my_cursor  CURSOR;

SET @my_cursor = CURSOR FORWARD_ONLY FOR
    SELECT id, calc_value FROM dbo.foo
    FOR READ ONLY;

OPEN @my_cursor;

WHILE 1 = 1
BEGIN
    FETCH NEXT FROM @my_cursor
    INTO
        @id
        , @calc_value;

    IF @@FETCH_STATUS <> 0
        BREAK;

    UPDATE dbo.foo
    SET calc_value = 123
    WHERE CURRENT OF @my_cursor;
END;

CLOSE @my_cursor;
DEALLOCATE @my_cursor;
```

Корректно

```sql
DECLARE
    @id           INT
    , @calc_value DECIMAL
    , @my_cursor  CURSOR;

SET @my_cursor = CURSOR FORWARD_ONLY FOR
    SELECT id, calc_value FROM dbo.foo
    FOR READ ONLY;

OPEN @my_cursor;

WHILE 1 = 1
BEGIN
    FETCH NEXT FROM @my_cursor
    INTO
        @id
        , @calc_value;

    IF @@FETCH_STATUS <> 0
        BREAK;

    UPDATE dbo.foo
    SET calc_value = 123
    WHERE id = @id;
END;

CLOSE @my_cursor;
DEALLOCATE @my_cursor;
```
