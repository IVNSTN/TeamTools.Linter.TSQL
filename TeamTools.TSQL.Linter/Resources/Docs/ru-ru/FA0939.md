

# Недопустимый агрегатный аргумент

|||
|-|-|
| Id | **FA0939**
| Мнемо | INVALID_AGGREGATE_ARG
| Серьёзность | ⚠ Предупреждение
| Категория | [Сбой](./Категория_Сбой.md)
| Исходный код | [InvalidAggregateArgumentRule.cs](../../../Rules/Failure/InvalidAggregateArgumentRule.cs)

## Причина

Правило срабатывает, если агрегатным функциям передаётся литерал NULL или подзапросы.
<p id="descr">Удалите NULL или подзапрос из агрегатной функции.</p>

## Примеры

Некорректно

```sql
SELECT SUM(AVG(sales_amount))
FROM dbo.sales;

SELECT COUNT(NULL) AS cnt
FROM dbo.sales_data pr
```

Корректно

```sql
WITH avg_sales AS 
(
  SELECT AVG(sales_amount) AS average_sales 
  FROM dbo.sales
)
SELECT SUM(average_sales)
FROM avg_sales;

SELECT COUNT(1) AS cnt
FROM dbo.sales_data pr
```

## Подсказки

💡 В SQL Server для некоторых статистических функций, таких как COUNT, MIN, MAX и таких функций, как DATEADD, требуется тип данных. NULL сам по себе не имеет такого типа, что приводит к ошибке.

💡 В SQL запросах при попытке использовать статистическую функцию, такую как SUM(), AVG(), COUNT() и т.д., для результата, который уже содержит статистическую функцию или подзапрос, возникает ошибка.