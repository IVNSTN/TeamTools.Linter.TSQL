
# Insert изменяет столбец, доступный только для чтения

|||
|-|-|
| Id | **FA0979**
| Мнемо | INSERT_MODIFIES_READONLY_COL
| Серьёзность | ⚠ Предупреждение
| Категория | [Сбой](./Категория_Сбой.md)
| Исходный код | [InsertModifiesReadonlyColumnRule.cs](../../../Rules/Failure/InsertModifiesReadonlyColumnRule.cs)

## Причина

Правило срабатывает, при попытке вставить данные в вычисляемый или IDENTITY столбец.
<p id="descr">Удалите вставку в вычисляемый или IDENTITY столбец.</p>

## Примеры

Некорректно

```sql
CREATE TABLE dbo.Product
(
    ProductId     INT          IDENTITY(1, 1) NOT NULL
    , ProductName VARCHAR(100) NOT NULL
    , Quantity    SMALLINT     NULL
    , Price       MONEY        NULL
    , Summa       AS (Quantity * Price) PERSISTED
);

INSERT INTO dbo.Product (ProductId, ProductName, Summa) VALUES (1, 'Product1', 100);
```

Корректно

```sql
CREATE TABLE dbo.Product
(
    ProductId     INT          IDENTITY(1, 1) NOT NULL
    , ProductName VARCHAR(100) NOT NULL
    , Quantity    SMALLINT     NULL
    , Price       MONEY        NULL
    , Summa       AS (Quantity * Price) PERSISTED
);

INSERT INTO dbo.Product (ProductName, Quantity, Price) VALUES ('Product1', 7, 100);
```

## Подсказки

💡 Чтобы вставить значение в IDENTITY столбец, можно использовать инструкцию SET IDENTITY_INSERT ON

```sql
SET IDENTITY_INSERT dbo.Product ON;
INSERT INTO dbo.Product (ProductId, ProductName, Summa)
VALUES (1, 'Product1', 7, 100);
SET IDENTITY_INSERT dbo.Product OFF;
```

## Ссылки

[SET IDENTITY_INSERT (Transact-SQL)](https://learn.microsoft.com/ru-ru/sql/t-sql/statements/set-identity-insert-transact-sql?view=sql-server-ver16)
