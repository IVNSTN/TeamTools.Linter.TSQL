

# Ветвление кода на основании текущего пользователя

|||
|-|-|
| Id | **HD0157**
| Мнемо | LOGIN_BASED_FLOW
| Серьёзность | ⚠ Предупреждение
| Категория | [Хардкод](./Категория_Хардкод.md)
| Исходный код | [LoginBasedCodeFlowRule.cs](../../../Rules/Hardcode/LoginBasedCodeFlowRule.cs)

## Причина

Правило срабатывает, если обнаруживается ветвление кода на основании имени текущего пользователя.
<p id="descr">Уберите ветвление кода, основанное на имени текущего пользователя.</p>

## Примеры

Некорректно

```sql
IF (@a = 'A') AND (ORIGINAL_LOGIN() = 'me')
    SELECT 1

UPDATE t SET
    foo = bar
FROM tbl AS t
WHERE t.name <> SUSER_SNAME()
    AND t.name <> SYSTEM_USER

WHILE CURRENT_USER != 'me' AND SESSION_USER != 'me'
    DELETE dbo.clients
```

Корректно

```sql
SELECT SYSTEM_USER, SUSER_SNAME(), CURRENT_USER

UPDATE t SET
    caller = SESSION_USER
FROM tbl AS t
WHERE caller IS NULL

WHILE @ORIGINAL_LOGIN = @SESSION_USER
    DELETE dbo.clients
```

## Подсказки

💡Доступ определяется грантами или внутренними привилегиями системы (где-то должны быть данные, управляющие привилегиями, а не хардкод). Ветвления алгоритмов - так же через данные (признаки, группы, роли, категории).
