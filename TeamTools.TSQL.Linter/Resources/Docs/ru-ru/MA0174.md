

# Ветвление кода на основе времени

|||
|-|-|
| Id | **MA0174**
| Мнемо | CLOCK_BASED_CODE_FLOW
| Серьёзность | ℹ Подсказка
| Категория | [Обслуживаемость](./Категория_Обслуживаемость.md)
| Исходный код | [ClockBasedCodeFlowRule.cs](../../../Rules/Maintainability/ClockBasedCodeFlowRule.cs)

## Причина

<p id="descr">Правило срабатывает, если в коде обнаружено условие использующее функции работы с текущими датой или временем.</p>

## Примеры

Некорректно

```sql
IF SYSDATETIME() > '19990101'
    SELECT GETDATE(), SYSDATETIME(), @today

UPDATE t
SET
    dtupdate = SYSDATETIME()
FROM tbl AS t
WHERE close_date < GETDATE();
```

Корректно

```sql
SELECT GETDATE(), SYSDATETIME(), @today;

UPDATE t
SET
    dtupdate = SYSDATETIME()
FROM tbl AS t
WHERE close_date IS NULL;
```

## Подсказки

💡 Где код вынужденно смотрит, например, на то, а торговое ли сейчас время, выносите это знание в скалярную функцию с вычислением и времени, и итогового признака внутри. Такую функцию хотя бы можно будет подменить для тестов, а не ждать наступления условленного часа для запуска теста.

💡 Крайне желательно уходить от IF-ELSE к STATE/STRATEGY, например, на основе данных. Сложить время работы в "таблицу-календарь" (таблицу-расписание) и понимать, какой нужен алгоритм действий по результату селекта, а не из хардкода про то, где что, во сколько в этом году начинается и заканчивается.
