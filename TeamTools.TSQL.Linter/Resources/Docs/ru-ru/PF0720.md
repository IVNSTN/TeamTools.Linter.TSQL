
# Непредвиденная сортировка результирующего набора CTE

|||
|-|-|
| Id | **PF0720**
| Мнемо | SORTED_CTE
| Серьёзность | ⚠ Предупреждение
| Категория | [Производительность](./Категория_Производительность.md)
| Исходный код | [SortedOutputFromCteRule.cs](../../../Rules/Performance/SortedOutputFromCteRule.cs)

## Причина

Правило срабатывает, если в коде обнаруживается сортировка результирующего набора данных в `CTE`.
<p id="descr">Удалите сортировку.</p>

## Примеры

Некорректно

```sql
WITH foo AS (
    SELECT TOP 100 PERCENT a, b, c
    FROM dbo.bar
    ORDER BY a DESC
)
SELECT a, b, c
FROM foo;
```

Корректно

```sql
WITH foo AS (
    SELECT a, b, c
    FROM dbo.bar
)
SELECT a, b, c
FROM foo
ORDER BY a DESC;
```

## Подсказки

💡 Сортировать результирующий набор в `CTE` не нужно, так как они встраиваются в другие запросы, где будет итоговая сортировка. Сортировка в `CTE` либо избыточна, либо может привести к ненадежному решению.
