
# Не отфильтрованный SPARSE столбец в индексе

|||
|-|-|
| Id | **PF0775**
| Мнемо | SPARSE_COL_INDEX_FILTER
| Серьёзность | ⚠ Предупреждение
| Категория | [Производительность](./Категория_Производительность.md), [Индексы](./Группа_Индексы.md)
| Исходный код | [SparseColumnIndexFilterRule.cs](../../../Rules/Performance/SparseColumnIndexFilterRule.cs)

## Причина

Правило срабатывает, если для SPARSE столбца в индексе не отфильтрованы значения `NULL`.
<p id="descr">Отфильтруйте значения NULL.</p>

## Примеры

Некорректно

```sql
CREATE TABLE dbo.foo (bar INT SPARSE NULL);

CREATE INDEX ix ON dbo.foo (bar);
```

Корректно

```sql
CREATE TABLE dbo.foo (bar INT SPARSE NULL, far BIT NOT NULL);

-- фильтрованный
CREATE INDEX IXF_dbo_foo_bar
    ON dbo.foo (bar)
    WHERE bar IS NOT NULL;

-- без SPARSE
CREATE INDEX IX_dbo_foo_far ON dbo.foo (far);

-- без ключа
CREATE INDEX IXI_dbo_foo_far ON dbo.foo (far) INCLUDE (bar);
```

## Подсказки

💡 Разреженные столбцы в основном хранят `NULL`-значения, поэтому, если строить индекс по таким столбцам, то имеет смысл отбросить все `NULL`-значения, иначе селективность будет очень плохая.
