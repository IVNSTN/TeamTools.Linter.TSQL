

# Непредвиденная сортировка результирующего набора функции

|||
|-|-|
| Id | **PF0951**
| Мнемо | FN_SORTED_OUTPUT
| Серьёзность | ⚠ Предупреждение
| Категория | [Производительность](./Категория_Производительность.md)
| Исходный код | [SortedOutputFromFunctionRule.cs](../../../Rules/Performance/SortedOutputFromFunctionRule.cs)

## Причина

<p id="descr">Сортировать результирующий набор функции не нужно, так как они встраиваются в другие запросы, где будет итоговая сортировка. Сортировка в функции либо избыточна, либо может привести к ненадежному решению.</p>

## Примеры

Некорректно

```sql
CREATE FUNCTION dbo.my_fn ()
RETURNS TABLE
AS
    RETURN
    SELECT TOP (50) id, title FROM dbo.foo ORDER BY id;
```

Корректно

```sql
CREATE FUNCTION dbo.my_fn ()
RETURNS TABLE
AS
    RETURN
    SELECT TOP (1) id, title FROM dbo.foo ORDER BY id;
```

## Подсказки

💡 В интерфейсах приложений пользователи часто могут менять сортировку самостоятельно, что делает сортировку в функциях бессмысленной. Даже если они не могут этого сделать, фиксированная сортировка - это решение на уровне приложения, и переносить это знание и ответственность в базу данных не является удачным подходом. Пусть сортировкой занимается приложение.

💡 Правило не реагирует если к сортировке применены:
* TOP (1) - функция вполне может быть предназначена для вычисления одного наиболее подходящего значения
* OFFSET FETCH - функция вполне может применяться для пагинации ли чего-то подобного
