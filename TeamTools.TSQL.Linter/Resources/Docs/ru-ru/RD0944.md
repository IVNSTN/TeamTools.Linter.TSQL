

# Использование COUNT вместо [NOT] EXISTS

|||
|-|-|
| Id | **RD0944**
| Мнемо | EXISTS_INSTEAD_OF_COUNT
| Серьёзность | ⚠ Предупреждение
| Категория | [Избыточность](./Категория_Избыточность.md)
| Исходный код | [RedundantCountRule.cs](../../../Rules/Redundancy/RedundantCountRule.cs)

## Причина

Правило срабатывает, если обнаружено использование SELECT COUNT() в целях определения наличия строк в наборе данных.
<p id="descr">Для определения наличия строк используйте EXISTS.</p>

## Примеры

Некорректно

```sql
IF (SELECT COUNT(1) FROM dbo.bar) > 0
    RETURN 1

SELECT 1
FROM dbo.foo
WHERE (SELECT COUNT((1)) FROM dbo.bar) >= 0
```

Корректно

```sql
IF EXISTS (SELECT COUNT(1) FROM dbo.bar)
    RETURN 1

SELECT 1
FROM dbo.foo
WHERE (SELECT COUNT(*) * 2 FROM dbo.bar) >= 1
```

## Подсказки

💡 Для вычисления COUNT нужно пройтись по всему набору данных, а EXISTS это и SEMI JOIN, и прекращение выполнения на первом же совпадении.

💡 С точки зрения понимания смысла написанного, EXISTS также предпочтительнее, поскольку явно обозначает, что нужно проверить наличие/отсутствие совпадения, а вычисление счетчика создает иллюзию, что интересует именно количество. Т.е. могли захотеть сравнивать не с нулем, а с 42 или чем-то еще, что только путает.
